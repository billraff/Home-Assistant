
  - trigger:
      - platform: state
        entity_id: media_player.office
        attribute: media_title
    sensor:
      - name: Recent Tracks
        state: "{{ now().timestamp() | timestamp_custom() }}"
        attributes:
          tracks: >
            {% set current = this.attributes.get('tracks', []) %}
            {% set new = [{
                "artist": trigger.to_state.attributes.media_artist,
                "title": trigger.to_state.attributes.media_title,
                "album": trigger.to_state.attributes.media_album_name,
                "time": now().isoformat() }]
                if is_state('media_player.office', 'playing') else [] %}
            {{ (new + current)[:20] }}
      - name: "Grid Export for Energy Dashboard"
        unique_id: "grid_export_energy_dashboard"
        state: "{{ states('sensor.powerwall_site_export') }}"
        unit_of_measurement: "kWh"
        state_class: "total_increasing"
        device_class: "energy"
      - name: "Grid Import for Energy Dashboard"
        unique_id: "grid_import_energy_dashboard"
        state: "{{ states('sensor.powerwall_site_import') }}"
        unit_of_measurement: "kWh"
        state_class: "total_increasing"
        device_class: "energy"

        